<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" href="sudax.png" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="Sudhakar Ramasamy's Assistant" />
    <meta
      name="keywords"
      content="sudax, sudhakar, sudhakar3697, rsudhakar3697, sudhakar ramasamy"
    />
    <meta name="author" content="Sudhakar Ramasamy" />
    <title>Sudax</title>
  </head>
  <body>
    <div id="container">
      <h1>Sudax</h1>
      <div>
        <button id="media-button">Pause/Resume YT/Spotify</button>
        <br />
        <br />
        <button id="sys-lock-button">Lock System</button>
        <br />
        <br />
        <button id="min-win-button">Minimize Windows</button>
        <br />
        <br />
      </div>
      <div>
        <label for="content-ta" style="font-weight: bolder">Action</label>
        <br />
        <br />
        <textarea rows="5" cols="100" id="content-ta"></textarea>
        <br />
        <br />
        <button id="send-button">Send</button>
      </div>
      <div>
        <ul id="events_panel"></ul>
      </div>
    </div>
  </body>
</html>

<script>
  const eventsPanel = document.getElementById("events_panel");
  const sendButton = document.getElementById("send-button");
  const mediaButton = document.getElementById("media-button");
  const sysLockButton = document.getElementById("sys-lock-button");
  const minWinButton = document.getElementById("min-win-button");

  if ("serviceWorker" in navigator) {
    navigator.serviceWorker
      .register("sw.js")
      .then((registration) => {
        console.log(
          "Service Worker registered with scope:",
          registration.scope
        );

        // Listen for messages from the service worker
        navigator.serviceWorker.addEventListener("message", function (event) {
          const data = event.data;
          console.log("Client received a message:", data);
          addEntryToEventsPanel(data);
        });
      })
      .catch((error) => {
        console.error("Service Worker registration failed:", error);
      });
  }

  requestNotificationPermission();

  sendButton.addEventListener("click", (e) => {
    const data = document.getElementById("content-ta").value;
    console.log(data);
    sendEvent(data);
  });

  mediaButton.addEventListener("click", (e) => {
    sendEvent("toggle");
  });

  sysLockButton.addEventListener("click", (e) => {
    sendEvent("lock");
  });

  minWinButton.addEventListener("click", (e) => {
    sendEvent("minimize");
  });

  function requestNotificationPermission() {
    Notification.requestPermission().then((permission) => {
      if (permission === "granted") {
        console.log("Notification permission granted.");
      } else {
        console.log("Unable to get notification permission.");
      }
    });
  }

  function showClientNotification(title, message) {
    const notification = new Notification(title, {
      body: message,
    });
    notification.onclick = function () {
      console.log("Notification clicked!");
    };
  }

  function addEntryToEventsPanel(data) {
    const li = document.createElement("li");
    li.innerText = data;
    eventsPanel.appendChild(li);
  }

  async function sendEvent(data) {
    if (navigator.onLine) {
      const res = await fetch("https://ntfy.sh/sudaxo", {
        method: "POST",
        body: data,
      });
      const resp = await res.json();
      console.log(resp);
    } else {
      alert("You are offline!");
    }
  }
</script>
